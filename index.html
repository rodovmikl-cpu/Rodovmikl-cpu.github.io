<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>schooltrade</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #f0f4ff, #d9e7ff);
  text-align: center;
  direction: rtl;
  margin-bottom: 220px;
  color: #222;
}
.box {
  background: #ffffff;
  padding: 20px;
  margin: 20px auto;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  max-width: 420px;
  transition: transform 0.2s ease;
}
.box:hover { transform: scale(1.01); }
input, textarea {
  width: 90%; padding: 10px; margin: 8px 0;
  border-radius: 8px; border: 1px solid #ccc; text-align: center;
  font-size: 15px;
}
button {
  padding: 10px 16px; border: none; background: #0078ff;
  color: white; border-radius: 8px; cursor: pointer; margin: 6px;
  font-weight: bold; transition: 0.3s;
}
button:hover { background: #005fcc; }
video, canvas, img { width: 100%; max-width: 360px; border-radius: 10px; margin-top: 10px; }
#allPosts { margin-bottom: 120px; }
#createPost { position: fixed; bottom: 0; left: 0; right: 0; background: #fff;
  box-shadow: 0 -2px 12px rgba(0,0,0,0.08); padding: 8px; border-top: 1px solid #ddd;
  max-width: 420px; margin: 0 auto; text-align: center; }
#togglePostBox { width: 95%; padding: 8px; background: #0078ff; color: white; border-radius: 8px; cursor: pointer; }
#togglePostBox:hover { background: #005fcc; }
.post { background: #fff; margin: 10px auto; padding: 10px; border-radius: 10px; box-shadow: 0 0 6px rgba(0,0,0,0.06); max-width: 380px; text-align: right; }
.comment-section { margin-top: 10px; background: #f8faff; border-radius: 8px; padding: 6px; }
.comment { text-align: right; border-bottom: 1px solid #eee; padding: 4px 0; font-size: 14px; }
.comment-input { display: flex; justify-content: space-between; margin-top: 6px; }
.comment-input input { width: 75%; padding: 6px; border-radius: 6px; border: 1px solid #ccc; }
.comment-input button { width: 20%; font-size: 13px; padding: 6px; }
#regMessage { min-height: 20px; margin-top: 6px; color: #0a7a00; font-weight: bold; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="box" id="registerBox">
  <h2>×”×¨×©××”</h2>
  <input type="text" id="nickname" placeholder="×”×›× ×¡ ×©× ×•×©× ××©×¤×—×” ×©×œ×š">
  <button id="registerBtn">×”×¨×©×</button>
  <div id="regMessage"></div>
  <div id="showCodeBox" style="display:none;">
    <p>×”×§×•×“ ×©×œ×š:</p>
    <h3 id="generatedCode"></h3>
    <button id="copyCodeBtn">×”×¢×ª×§ ×§×•×“</button>
    <p>×©××•×¨ ××ª ×”×§×•×“ â€” ×ª×¦×˜×¨×š ××•×ª×• ×›×“×™ ×œ×”×ª×—×‘×¨!</p>
    <button id="continueBtn">×”××©×š</button>
  </div>
</div>

<div class="box" id="loginBox" style="display:none;">
  <h2>×”×ª×—×‘×¨×•×ª</h2>
  <input type="text" id="loginCode" placeholder="×”×›× ×¡ ××ª ×”×§×•×“">
  <button id="loginBtn">×”×ª×—×‘×¨</button>
  <div id="logMessage"></div>
</div>

<div class="box" id="welcomeBox" style="display:none;">
  <h2 id="welcomeText"></h2>
  <video id="camera" autoplay playsinline></video><br>
  <button id="capture">ğŸ“¸ ×¦×œ× ×ª××•× ×”</button>
  <canvas id="photo" style="display:none;"></canvas>
  <img id="preview" alt="×ª×¦×•×’×” ××§×“×™××”" style="display:none;"><br>
  <button id="logoutBtn">ğŸ”’ ×”×ª× ×ª×§</button>
</div>

<div id="allPosts" style="display:none;">
  <h2>ğŸ–¼ ×¤×•×¡×˜×™× ×©×œ ××©×ª××©×™×</h2>
  <div id="postsList"></div>
</div>

<div id="createPost" style="display:none;">
  <button id="togglePostBox">âœ ×¤×¨×¡× ×¤×•×¡×˜</button>
  <div id="postBox" style="display:none; margin-top:10px;">
    <textarea id="description" placeholder="×›×ª×•×‘ ×ª×™××•×¨ ××• ××§×•× ××¤×’×©"></textarea><br>
    <input type="number" id="price" placeholder="××—×™×¨ (â‚ª)"><br>
    <button id="savePostBtn">ğŸ“¤ ×¤×¨×¡×</button>
  </div>
</div>

<div id="adminPanel" style="display:none;" class="box">
  <h2>âš™ × ×™×”×•×œ ×× ×”×œ</h2>
  <h3>×¨×©×™××ª ×—×©×‘×•× ×•×ª</h3>
  <div id="usersList"></div>
  <hr>
  <button id="clearAllBtn">ğŸ—‘ ××—×§ ××ª ×›×œ ×”×¤×•×¡×˜×™×</button>
</div>

<script>
const supabase = window.supabase.createClient(
  'https://fxskzfjezoolsgqytumw.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ4c2t6Zmplem9vbHNncXl0dW13Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwNTkzODksImV4cCI6MjA3NjYzNTM4OX0.MYIWkWhdVNzlqs53l4a4eJXQJeJpf0bD3kQQCDN-zrI'
);

let savedCode = "", savedName = "";

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
async function register() {
  const nickname = document.getElementById("nickname").value.trim();
  if (!nickname) { alert("×× × ×”×›× ×¡ ×©×"); return; }

  const code = Math.floor(100000000 + Math.random() * 900000000).toString();
  const { error } = await supabase.from('users').insert([{ code, name: nickname }]);
  if (error) { alert("×©×’×™××” ×‘×”×¨×©××”: " + error.message); return; }

  savedCode = code; savedName = nickname;
  document.getElementById("generatedCode").innerText = code;
  document.getElementById("showCodeBox").style.display = "block";
  document.getElementById("regMessage").innerText = "× ×¨×©××ª ×‘×”×¦×œ×—×”!";
}

// ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ° Ğº Ğ»Ğ¾Ğ³Ğ¸Ğ½Ñƒ
document.getElementById("continueBtn").onclick = () => {
  document.getElementById("registerBox").style.display = "none";
  document.getElementById("loginBox").style.display = "block";
};

// ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°
document.getElementById("copyCodeBtn").onclick = () => {
  navigator.clipboard.writeText(savedCode);
  alert("×”×§×•×“ ×”×•×¢×ª×§!");
};

// ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ°
async function login() {
  const code = document.getElementById("loginCode").value.trim();
  if (!code) return;
  if (code === "admin" || code === "michaelrodov") {
    savedCode = code; savedName = code; enterUser(true); return;
  }
  const { data, error } = await supabase.from('users').select().eq('code', code).single();
  if (error || !data) { alert("×§×•×“ ×©×’×•×™!"); return; }
  savedCode = data.code; savedName = data.name;
  enterUser(false);
}
document.getElementById("registerBtn").onclick = register;
document.getElementById("loginBtn").onclick = login;

// Ğ’Ñ…Ğ¾Ğ´ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
function enterUser(isAdmin) {
  document.getElementById("registerBox").style.display = "none";
  document.getElementById("loginBox").style.display = "none";
  document.getElementById("welcomeBox").style.display = "block";
  document.getElementById("allPosts").style.display = "block";
  document.getElementById("createPost").style.display = isAdmin ? "none" : "block";
  document.getElementById("adminPanel").style.display = isAdmin ? "block" : "none";
  document.getElementById("welcomeText").innerText = "×‘×¨×•×š ×”×‘× " + savedName;
  startCamera();
}

// ĞšĞ°Ğ¼ĞµÑ€Ğ°
const video = document.getElementById("camera");
const canvas = document.getElementById("photo");
const preview = document.getElementById("preview");
document.getElementById("capture").onclick = () => {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);
Â Â preview.src
