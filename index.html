<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>schooltrade</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #f0f4ff, #d9e7ff);
  text-align: center;
  direction: rtl;
  margin-bottom: 220px;
  color: #222;
}
.box {
  background: #ffffff;
  padding: 20px;
  margin: 20px auto;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  max-width: 420px;
  transition: transform 0.2s ease;
}
.box:hover { transform: scale(1.01); }
input, textarea {
  width: 90%;
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  text-align: center;
  font-size: 15px;
}
button {
  padding: 10px 16px;
  border: none;
  background: #0078ff;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  margin: 6px;
  font-weight: bold;
  transition: 0.3s;
}
button:hover { background: #005fcc; }
video, canvas, img { width: 100%; max-width: 360px; border-radius: 10px; margin-top: 10px; }
#allPosts { margin-bottom: 120px; }
#createPost {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #fff;
  box-shadow: 0 -2px 12px rgba(0,0,0,0.08);
  padding: 8px;
  border-top: 1px solid #ddd;
  max-width: 420px;
  margin: 0 auto;
  text-align: center;
}
#togglePostBox { width: 95%; padding: 8px; background: #0078ff; color:white; border-radius:8px; cursor:pointer; }
#togglePostBox:hover { background:#005fcc; }
.post { background:#fff; margin:10px auto; padding:10px; border-radius:10px; box-shadow:0 0 6px rgba(0,0,0,0.06); max-width:380px; text-align:right; }
.post img { width:100%; border-radius:8px; }
.comment-section { margin-top:10px; background:#f8faff; border-radius:8px; padding:6px; }
.comment { text-align:right; border-bottom:1px solid #eee; padding:4px 0; font-size:14px; }
.comment-input { display:flex; justify-content:space-between; margin-top:6px; }
.comment-input input { width:75%; padding:6px; border-radius:6px; border:1px solid #ccc; }
.comment-input button { width:20%; font-size:13px; padding:6px; }
#regMessage { min-height:20px; margin-top:6px; color:#0a7a00; font-weight:bold; }
.user-row { display:flex; justify-content:space-between; align-items:center; margin:4px 0; }
.user-delete { background:#ff4d4f; color:white; padding:4px 8px; border-radius:4px; cursor:pointer; }
.user-delete:hover { background:#cc0000; }
</style>
</head>
<body>

<div class="box" id="registerBox">
<h2>×”×¨×©××”</h2>
<input type="text" id="nickname" placeholder="×”×›× ×¡ ×©× ×•×©× ××©×¤×—×” ×©×œ×š">
<button id="registerBtn">×”×™×¨×©×</button>
<div id="regMessage"></div>
<div id="showCodeBox" style="display:none;">
<p>×”×§×•×“ ×©×œ×š:</p>
<h3 id="generatedCode"></h3>
<button id="copyCodeBtn">×”×¢×ª×§ ×§×•×“</button>
<p>×©××•×¨ ××ª ×”×§×•×“ â€” ×ª×¦×˜×¨×š ××•×ª×• ×›×“×™ ×œ×”×ª×—×‘×¨!</p>
<button id="continueBtn">×”××©×š</button>
</div>
</div>

<div class="box" id="loginBox" style="display:none;">
<h2>×”×ª×—×‘×¨×•×ª</h2>
<input type="text" id="loginCode" placeholder="×”×›× ×¡ ××ª ×”×§×•×“">
<button id="loginBtn">×”×ª×—×‘×¨</button>
<div id="logMessage"></div>
</div>

<div class="box" id="welcomeBox" style="display:none;">
<h2 id="welcomeText"></h2>
<video id="camera" autoplay playsinline></video><br>
<button id="capture">ğŸ“¸ ×¦×œ× ×ª××•× ×”</button>
<canvas id="photo" style="display:none;"></canvas>
<img id="preview" alt="×ª×¦×•×’×” ××§×“×™××”" style="display:none;"><br>
<button id="logoutBtn">ğŸ”’ ×”×ª× ×ª×§</button>
</div>

<div id="allPosts" style="display:none;">
<h2>ğŸ–¼ ×¤×•×¡×˜×™× ×©×œ ××©×ª××©×™×</h2>
<div id="postsList"></div>
</div>

<div id="createPost" style="display:none;">
<button id="togglePostBox">âœ ×¤×¨×¡× ×¤×•×¡×˜</button>
<div id="postBox" style="display:none; margin-top:10px;">
<textarea id="description" placeholder="×›×ª×•×‘ ×ª×™××•×¨ ××• ××§×•× ××¤×’×©"></textarea><br>
<input type="number" id="price" placeholder="××—×™×¨ (â‚ª)"><br>
<button id="savePostBtn">ğŸ“¤ ×¤×¨×¡×</button>
</div>
</div>

<div id="adminPanel" style="display:none;" class="box">
<h2>âš™ × ×™×”×•×œ ×× ×”×œ</h2>
<h3>×¨×©×™××ª ×—×©×‘×•× ×•×ª</h3>
<div id="usersList"></div>
<hr>
<button id="clearAllBtn">ğŸ—‘ ××—×§ ××ª ×›×œ ×”×¤×•×¡×˜×™×</button>
</div>

<script>
let users = {}; 
let posts = [];
let savedCode = "", savedName = "";

function saveData(){ localStorage.setItem("users", JSON.stringify(users)); localStorage.setItem("posts", JSON.stringify(posts)); }
function register(){
  const nickname = document.getElementById("nickname").value.trim();
  if(!nickname){ document.getElementById("regMessage").innerText="×× × ×”×›× ×¡ ×©× ××©×ª××©"; return; }
  let code; do{ code=Math.floor(100000000+Math.random()*900000000).toString(); }while(users[code]);
  users[code]={name:nickname}; saveData();
  savedName=nickname; savedCode=code;
  document.getElementById("generatedCode").innerText=code;
  document.getElementById("showCodeBox").style.display="block";
  document.getElementById("regMessage").innerText="× ×¨×©××ª ×‘×”×¦×œ×—×” â€” ×©××•×¨ ××ª ×”×§×•×“!";
}
document.getElementById("continueBtn").addEventListener("click",()=>{ document.getElementById("registerBox").style.display="none"; document.getElementById("loginBox").style.display="block"; });
document.getElementById("registerBtn").addEventListener("click",register);

function login(){
  const loginCode=document.getElementById("loginCode").value.trim();
  document.getElementById("logMessage").innerText="";
  if(loginCode==="admin"||loginCode==="michaelrodov"){ savedCode=loginCode; savedName=loginCode; enterUser(true); return; }
  if(users[loginCode]){ savedCode=loginCode; savedName=users[loginCode].name; enterUser(false); }
  else document.getElementById("logMessage").innerText="×§×•×“ ×©×’×•×™!";
}
document.getElementById("loginBtn").addEventListener("click",login);

function enterUser(isAdmin){
  document.getElementById("loginBox").style.display="none";
  document.getElementById("registerBox").style.display="none";
  document.getElementById("welcomeBox").style.display="block";
  document.getElementById("allPosts").style.display="block";
  document.getElementById("createPost").style.display=isAdmin?"none":"block";
  document.getElementById("welcomeText").innerText="×‘×¨×•×š ×”×‘×, "+savedName+"!";
  document.getElementById("adminPanel").style.display=isAdmin?"block":"none";
  if(!isAdmin) startCamera();
  showPosts();
  if(isAdmin) showUsersList();
}
document.getElementById("logoutBtn").addEventListener("click",()=>{ logout(); });

function logout(){
  document.getElementById("welcomeBox").style.display="none
